{% extends 'base.html' %}
{% load static %}

{% block title %}AI Solutions - {{ settings.site_name }}{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="bg-gradient-primary text-white py-5" style="margin-top: 80px;">
    <div class="container py-4">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h1 class="display-4 fw-bold mb-3">AI Solutions</h1>
                <p class="lead">Discover how our cutting-edge AI solutions can transform your industry</p>
            </div>
        </div>
    </div>
</section>

<!-- Filter Section -->
<section class="py-4 bg-light">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <div class="d-flex gap-2 flex-wrap">
                    <a href="{% url 'core:solutions' %}"
                        class="btn {% if not selected_category %}btn-primary{% else %}btn-outline-primary{% endif %}">
                        All Solutions
                    </a>
                    {% for value, label in categories %}
                    <a href="{% url 'core:solutions' %}?category={{ value }}"
                        class="btn {% if selected_category == value %}btn-primary{% else %}btn-outline-primary{% endif %}">
                        {{ label }}
                    </a>
                    {% endfor %}
                </div>
            </div>
            <div class="col-lg-6 text-lg-end mt-3 mt-lg-0">
                <small class="text-muted">
                    <i class="bi bi-info-circle me-1"></i>
                    {{ solutions|length }} solution{{ solutions|length|pluralize }} available
                </small>
            </div>
        </div>
    </div>
</section>

<!-- Solutions Grid -->
<section class="py-5">
    <div class="container">
        {% if solutions %}
        <div class="row g-4">
            {% for solution in solutions %}
            <div class="col-lg-4 col-md-6">
                <div class="card h-100 shadow-sm border-0 solution-card">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div class="bg-primary bg-opacity-10 rounded p-3">
                                <i class="bi bi-{{ solution.icon }} text-primary fs-2"></i>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-secondary">{{ solution.get_category_display }}</span>
                                {% if solution.is_featured %}
                                <br><span class="badge bg-warning text-dark mt-1">Featured</span>
                                {% endif %}
                            </div>
                        </div>

                        <h4 class="card-title fw-bold">{{ solution.title }}</h4>
                        <p class="card-text text-muted flex-grow-1">{{ solution.description }}</p>

                        <!-- Features List -->
                        {% if solution.features %}
                        <div class="mb-4">
                            <h6 class="fw-bold text-primary mb-2">Key Features:</h6>
                            <ul class="list-unstyled">
                                {% for feature in solution.features %}
                                <li class="d-flex align-items-center mb-2">
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    <small>{{ feature }}</small>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        <div class="d-flex gap-2 mt-auto align-items-center">
                            <a href="{% url 'core:solution_detail' solution.slug %}" class="btn btn-sm btn-primary">
                                Learn More
                            </a>
                        </div>
                    </div>

                    {% if solution.image %}
                    <div class="card-footer bg-transparent border-0 p-0">
                        <img src="{{ solution.image.url }}" class="img-fluid rounded-bottom" alt="{{ solution.title }}"
                            style="height: 200px; width: 100%; object-fit: cover;">
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        {% else %}
        <div class="text-center py-5">
            <i class="bi bi-robot text-muted" style="font-size: 4rem;"></i>
            <h3 class="mt-3">No Solutions Found</h3>
            <p class="text-muted">There are no solutions available for the selected category.</p>
            <a href="{% url 'core:solutions' %}" class="btn btn-primary">View All Solutions</a>
        </div>
        {% endif %}
    </div>
</section>

<!-- CTA Section -->
<section class="py-5 bg-primary text-white">
    <div class="container text-center">
        <h2 class="display-5 fw-bold mb-3">Ready to Get Started?</h2>
        <p class="lead mb-4">Let us help you choose the right AI solution for your business needs</p>
        <div class="d-flex justify-content-center gap-3">
            <a href="{% url 'core:contact' %}" class="btn btn-warning btn-lg">Contact Us</a>
            <button class="btn btn-outline-light btn-lg" onclick="requestConsultation()">
                Free Consultation
            </button>
        </div>
    </div>
</section>

<!-- Solution Detail Modal -->
<div class="modal fade" id="solutionDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="solutionModalTitle">Solution Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="solutionModalBody">
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer" id="solutionModalFooter">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Demo Request Modal -->
<div class="modal fade" id="demoRequestModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Request Demo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="demoRequestForm">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="demoName" class="form-label">Full Name *</label>
                        <input type="text" class="form-control" id="demoName" required>
                    </div>
                    <div class="mb-3">
                        <label for="demoEmail" class="form-label">Email Address *</label>
                        <input type="email" class="form-control" id="demoEmail" required>
                    </div>
                    <div class="mb-3">
                        <label for="demoCompany" class="form-label">Company *</label>
                        <input type="text" class="form-control" id="demoCompany" required>
                    </div>
                    <div class="mb-3">
                        <label for="demoPhone" class="form-label">Phone Number</label>
                        <input type="tel" class="form-control" id="demoPhone">
                    </div>
                    <div class="mb-3">
                        <label for="demoMessage" class="form-label">Additional Information</label>
                        <textarea class="form-control" id="demoMessage" rows="3"
                            placeholder="Tell us about your specific requirements..."></textarea>
                    </div>
                    <div id="demoMessage"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Request Demo</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .solution-card {
        transition: transform 0.3s, box-shadow 0.3s;
    }

    .solution-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1) !important;
    }

    .bg-gradient-primary {
        background: linear-gradient(135deg, var(--bs-primary) 0%, var(--bs-info) 100%);
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    function showSolutionDetail(solutionId) {
        const solutions = {
        {% for solution in solutions %}
        { { solution.id } }: {
            title: "{{ solution.title|escapejs }}",
                description: "{{ solution.description|escapejs }}",
                    category: "{{ solution.get_category_display }}",
                        features: [{% for feature in solution.features %} "{{ feature|escapejs }}"{% if not forloop.last %}, {% endif %} {% endfor %}],
        image: "{% if solution.image %}{{ solution.image.url }}{% endif %}"
    },
    {% endfor %}
    };

    const solution = solutions[solutionId];
    if (solution) {
        document.getElementById('solutionModalTitle').textContent = solution.title;
        document.getElementById('solutionModalBody').innerHTML = `
            <div class="row">
                <div class="col-md-8">
                    <div class="mb-3">
                        <span class="badge bg-primary">${solution.category}</span>
                    </div>
                    <p class="lead">${solution.description}</p>
                    
                    ${solution.features.length > 0 ? `
                    <h6 class="fw-bold mb-3">Key Features:</h6>
                    <div class="row">
                        ${solution.features.map(feature => `
                            <div class="col-md-6 mb-2">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    <span>${feature}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                </div>
                <div class="col-md-4">
                    ${solution.image ? `
                    <img src="${solution.image}" class="img-fluid rounded mb-3" alt="${solution.title}">
                    ` : ''}
                    <div class="card bg-light">
                        <div class="card-body text-center">
                            <h6 class="card-title">Interested in this solution?</h6>
                            <p class="card-text small">Get in touch with our experts to learn more</p>
                            <button class="btn btn-primary btn-sm" onclick="requestDemo(${solutionId})">
                                Request Demo
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;

        const modal = new bootstrap.Modal(document.getElementById('solutionDetailModal'));
        modal.show();
    }
}

    function requestDemo(solutionId) {
        // Close solution modal if open
        const solutionModal = bootstrap.Modal.getInstance(document.getElementById('solutionDetailModal'));
        if (solutionModal) {
            solutionModal.hide();
        }

        // Show demo request modal
        const demoModal = new bootstrap.Modal(document.getElementById('demoRequestModal'));
        demoModal.show();

        // Store solution ID
        document.getElementById('demoRequestForm').dataset.solutionId = solutionId;
    }

    function requestConsultation() {
        requestDemo(0); // Use 0 for general consultation
    }

    document.getElementById('demoRequestForm').addEventListener('submit', function (e) {
        e.preventDefault();

        // Simulate form submission
        const messageDiv = document.getElementById('demoMessage');
        messageDiv.innerHTML = '<div class="alert alert-success">Thank you! We will contact you soon to schedule your demo.</div>';

        setTimeout(() => {
            const modal = bootstrap.Modal.getInstance(document.getElementById('demoRequestModal'));
            modal.hide();
            this.reset();
            messageDiv.innerHTML = '';
        }, 2000);
    });
</script>
{% endblock %}